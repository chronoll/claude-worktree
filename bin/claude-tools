#!/bin/bash

# Claude Worktree Creator
# Usage: claude-worktree <identifier>

if [ -z "$1" ]; then
    echo "Usage: claude-worktree <identifier>"
    echo "Example: claude-worktree netflix-clone"
    exit 1
fi

IDENTIFIER="$1"
REPO_NAME=$(basename $(pwd))
WORKTREE_DIR="../project-claude-${REPO_NAME}/${IDENTIFIER}"
BRANCH_NAME="feature/kurotaka-claude/${IDENTIFIER}"

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "Error: Not in a git repository"
    exit 1
fi

# Create worktree
echo "Creating worktree: $WORKTREE_DIR"
echo "Branch: $BRANCH_NAME"

git worktree add "$WORKTREE_DIR" -b "$BRANCH_NAME"

if [ $? -eq 0 ]; then
    echo "✅ Worktree created successfully"
    echo "📁 Directory: $WORKTREE_DIR"
    echo "🌿 Branch: $BRANCH_NAME"
    echo ""
    echo "Moving to worktree directory..."
    cd "$WORKTREE_DIR"
    
    echo "🚀 Starting Claude Code..."
    claude
else
    echo "❌ Failed to create worktree"
    exit 1
fi